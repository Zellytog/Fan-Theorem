%\emnote{intuition sur adequacy}

The main result to ensure a realizability model is sound is the adequacy lemma. This lemma has several implications, but is based on the idea that typed terms are realizers. If typing is seen as a syntactic and decidable specification on programs, then the adequacy means that programs satisfying the syntactic specification associated to a proposition $\varphi$ also satisfy the semantic specification associated to $\varphi$.

From a logical point of view, the Curry-Howard correspondence also tells us that these typing rules translate to inference rules. Indeed, formal proofs of a proposition $\varphi$, based on natural deduction, can be associated to $\lambda$-terms $t$ such that $\vdash t : \varphi$. Using this correspondence, the adequacy lemma also means that, for any two statements $\varphi,\psi$ such that $\varphi$ is realized and $\psi$ is logically entailed by $\varphi$, $\psi$ is also realized. This makes the set $\ThReal{\enviro}$ of realized propositions at some context $\enviro$, and the set $\ThRealU$ of uniformly realized propositions, into a logical theory, closed by deduction. This also means that the theory is consistent, as there are predicates with no realizers. The adequacy lemma is essential to show that our model separates $\FT$ from $\WKL$, as this shows that there is a consistent theory (namely $\ThRealU$) containing $\FT$ and not containing $\WKL$.

The proof of the adequacy lemma is an induction on the typing relation. For the cases about universal (resp. existential) quantification, a lemma is needed to relate the realizability of $\varphi[\termt/\varx]$ and the realizability of $\varphi$ where $\rho$ is enriched by $\varx\mapsto \rho(\termt)$.

\begin{lemma}
  Let $\enviro \in \Oracle$, $\Gamma \in \Hctx$, $\termenv \models \Gamma$ and suppose that $\Gamma, \varx : S \vdash \varphi : \Prop$ and $\Gamma\vdash \termt : S$. The following equivalence holds:
  \[t \realPP \varphi[\termt/\varx] \iff t \realP{\enviro}{\termenv[\varx\mapsto \termenv(\termt)]}\varphi \]
\end{lemma}

%\tlnote{J'ai mis la preuve en commentaire parce qu'elle est vraiment pas int√©ressante.}

%\begin{proof}
%  We must first prove by induction on terms $\termu$ that $\termenv(\termu[\termt/\varx]) = \termenv[\varx \mapsto \termenv(\termt)](\termu)$. Then, by induction on $\varphi$:
%  \begin{itemize}
%  \item if $\varphi = \sortPred{\termt}$, then we use the equality on terms to have $t \in \codE{\termenv(\termt)} \iff t \in \codE{\termenv(\termt)}$
%  \item the other four cases are straightforward by using the induction hypothesis to replace $\realPP \varphi[\termt/\varx]$ by $\realP{\enviro}{\termenv[\varx\mapsto\termenv(\termt)]} \varphi$.
%  \end{itemize}
%  Hence the result.
%\end{proof}

We also introduce the typing system we consider for this model. It can be seen as rules for logical deductions in HOL and rules describing the behavior of $\Nat,\Bool,\List$, \textit{i.e.} constructor rules saying that standard elements are indeed in the expected sort, and induction principles.

\begin{definition}[Typing system]
  We define a ($\lambda$-)context as a list $\Xi \in \List(\Xlam \times \Prop)$, whose elements we will write $(x : \varphi)$.

  The typing relation $\Gamma\mid \Xi \vdash t : \varphi$ is defined by induction by the rules in~\Cref{fig:typing_rules}.

\end{definition}
\begin{figure*}[t]
 \input{typing_rules}
 \caption{Typing rules}
 \label{fig:typing_rules}
\end{figure*}

\begin{theorem}[Adequacy]\label{thm:adequacy}
  Let $\enviro \in \Oracle$, $\Gamma \in \Hctx$, $\termenv \models \Gamma$, formulas
  \[\begin{cases}
  \Gamma\vdash \varphi_i : \Prop \qquad \forall i = 1,\ldots,n\\
  \Gamma\vdash \varphi : \Prop
  \end{cases}\]
  and terms
  \[\begin{cases}
  t_i \realPP \varphi_i \qquad \forall i = 1,\ldots,n\\
  \Gamma \mid x_1 : \varphi_1,\ldots,x_n : \varphi_n \vdash t : \varphi
  \end{cases}\]
  then $t[t_i/x_i] \realPP \varphi$.
\end{theorem}

The proof of adequacy is done by an induction on the typing relation $\Gamma\mid \Xi\vdash t : \varphi$ and is standard in realizability methods.

As the adequacy is defined for any $\enviro\in\Oracle$, it is straightforward that $\realU$ is also adequate.

%\begin{corollary}
%  Let $\Gamma\in \Hctx, \termenv \models \Gamma$, formulas
%  \[\begin{cases}
%  \Gamma\vdash \varphi_i : \Prop \qquad \forall i = 1,\ldots,n\\
%  \Gamma\vdash \varphi : \Prop
%  \end{cases}\]
%  and terms
%  \[\begin{cases}
%  t_i \realUP{\termenv} \varphi_i \qquad \forall i = 1, \ldots, n \\
%  \Gamma\mid x_1 : \varphi_1,\ldots,x_n : \varphi_n \vdash t : \varphi
%  \end{cases}\]
%  then $t[t_i/x_i] \realUP{\termenv} \varphi$.
%\end{corollary}

\begin{corollary}
For any $\enviro\in\Oracle$, the sets
%\[\ThRealU \defeq \{ \varphi \in \Prop \mid \exists t \in \Lambda, t \realU \varphi\}\]
\begin{align*}
\ThReal{\enviro} &\defeq \{ \varphi \in \Prop \mid \exists t \in \Lambda, t \realP{\enviro}{} \varphi\} \\
\ThRealU &\defeq \{ \varphi \in \Prop \mid \exists t \in \Lambda, t \realU \varphi\}
\end{align*}
are closed by logical consequence. Moreover, as $\SAT$ contains $\varnothing$,
\[\bot \defeq \forall \varphi^{\Prop}, \varphi\]
is not realized, so $\ThRealU$ (resp. $\ThReal{\enviro}$) is consistent.
\end{corollary}

\begin{notation}
  A lot of functions of our model are not described by any HOL-term but can have a realizer. Thus, we introduce the following notation for $t \in \Lambda, S \in \Sort, s \in \bS$:
  \[t \real S(s) \defeq t \realP{}{[\varx \mapsto s]} S(\varx)\]
  Given a $\lambda$-term $t$, there can be several objects $s,s' \in S$ such that $t$ is a code of $s$ (resp. $s'$): however, the intended behavior of $s$ (resp. $s'$) is given by the term $t$, and the choice of the object will not be relevant. For this reason, we will write
  \[t \real S \defeq \exists s \in \bS, t \real S(s)\]
\end{notation}
