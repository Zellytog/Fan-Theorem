\subsection{Evidenced frames}

The realizability model we give can be defined by an evidenced frame.

\begin{definition}[Evidenced frame]
  An evidenced frame $\EFE$ is a pair of sets $(E,\Phi)$ equiped with:
  \begin{itemize}
  \item a ternary relation $\relEFdot \subseteq E \times \Phi \times \Phi$
  \item an element $\witID$ such that
    \[\forall \varphi \in \Phi, \relEF \witID \varphi \varphi\]
  \item there exists a function $\witCompDot : E \times E \to E$ such that
    \[\forall \varphi, \psi, \chi \in \Phi, \forall \witx, \wity \in E, \relEF\witx\varphi\psi \implies \relEF\wity\psi\chi \implies \relEF{\witComp\witx\wity}{\varphi}{\chi}\]
  \item an element $\PropTop \in \Phi$ such that there exists an element $\witTop \in E$ such that
    \[\forall \varphi \in \Phi, \relEF\witTop\varphi\PropTop\]
  \item a function $\PropAndDot : \Phi \times \Phi \to \Phi$ such that there exist a function $\witPairDot : E \times E \to E$ and two elements $\witFst,\witSnd \in E$ such that
    \[\begin{array}{l}
    \forall \varphi, \psi \in \Phi, \relEF\witFst{\PropAnd\varphi\psi}\varphi\\
    
    \forall \varphi, \psi \in \Phi, \relEF\witSnd{\PropAnd\varphi\psi}\varphi\\
    
    \forall \varphi, \psi, \chi \in \Phi,\forall \witx,\wity \in E, \relEF\witx\varphi\psi \implies \relEF\wity\varphi\chi\implies \relEF{\witPair\witx\wity}\varphi{\PropAnd\psi\chi}
    \end{array}\]
  \item a function $\PropImplDot : \Phi \times \powerset(\Phi) \to \Phi$ such that there exist a function $\witLam{} : E \to E$ and an element $\witEval$ such that
    \[\begin{array}{l}
    \forall \varphi,\psi \in \Phi, \forall \vec{\chi}\in \powerset(\Phi), \forall \witx \in E, (\forall \chi \in \vec \chi, \relEF\witx{\PropAnd\varphi\psi}\chi) \implies \relEF{\witLam\witx}\varphi{\PropImpl\psi{\vec{\chi}}}\\
    \forall \varphi \in \Phi, \forall \vec{\psi} \in \powerset(\Phi),\forall \psi \in \vec{\psi}, \relEF{\witEval}{\PropAnd{(\PropImpl{\varphi}{\vec\psi})}\varphi}\psi
    \end{array}\]
  \end{itemize}
\end{definition}

\begin{proposition}[Saturated sequences]
  Using our previous convention, we define the two sets
  \[E \defeq \Lambda \qquad \Phi \defeq
  \left\{\left.(A_\enviro) \in \prod_{\enviro \in \Oracle} \SATE \right\vert \forall \enviro,\enviroT \in \Oracle, \enviro\infOr\enviroT \implies A_\enviro \subseteq A_\enviroT \right\}\]
  with the following elements:
  \begin{itemize}
  \item the relation is given by
    \[\relEF t {\varA}{\varB}\defeq \forall \enviro \in \Oracle, \forall u \in \termAE, tu \in \termBE\]
  \item the identity element is $\witID \defeq \lambda x.x$
  \item the composition function is
    \[\witComp t u \defeq \lambda x.u\;(t\;x)\]
  \item the truth proposition is $\PropTop \defeq \enviro \mapsto \Lambda$ and the evidence for this is $\witTop \defeq \lambda x.x$
  \item the conjunction function is
    \[\PropAndDot \defeq (\varA,\varB) \mapsto \enviro \mapsto
    \{t \in \Lambda \mid (\pi_1\;t \in A_\enviro)\land (\pi_2\;t \in B_\enviro)\}\]
    the pairing function is
    \[\witPair t u \defeq \lambda x. \langle t\;x,u\;x \rangle\]
    with $\witFst \defeq \pi_1$ and $\witSnd \defeq \pi_2$
  \item the implication function is
    \[\PropImplDot \defeq (\varA,\FamB) \mapsto \enviro \mapsto
    \{t \in \Lambda \mid
    \forall \enviroT \in \cyl{\enviro}, \forall u \in A_\enviroT,\\
      tu \in B_\enviroT\}\]
    with abstraction function $\witLam t \defeq \lambda x.\lambda y. t\;\langle x,y\rangle$ and evaluation element $\witEval \defeq \lambda x.\pi_1\;x\;(\pi_2\;x)$
  \end{itemize}
  this data gives an evidenced frame.
\end{proposition}

\begin{proof}
  We need to prove the properties of each element:
  \begin{itemize}
  \item for any $\varA \in \Phi$, $\relEF{\lambda x.x}{\varA}{\varA}$: for $\enviro \in \Oracle$, for any $t \in \termAE$, $(\lambda x.x)t \redE t$, so by saturation $(\lambda x.x)t \in \termAE$.
  \item for any $\varA,\varB,\varC\in \Phi$, $t,u \in \Lambda$ such that $\relEF t {\varA}{\varB}$ and $\relEF u {\varB}{\varC}$, we have $\relEF{\lambda x.u\;(t\;x)}{\varA}{\varC}$: for $\enviro \in \Oracle$, for any $v \in \termAE$, we know that $t\;v \in \termBE$ (by hypothesis on $t$) and thus that $u\;(t\;v) \in \termCE$ (by hypothesis on $u$), but $(\lambda x.u\;(t\;x))\;v \redE u\;(t\;v)$, hence the result by saturation.
  \item for any $\varA \in \Phi, \relEF{\lambda x.x}{\varA}{\PropTop}$ is automatic: any term instead of $\lambda x.x$ would satisfy this property.
  \item for any $\varA,\varB \in \Phi$, $\relEF{\pi_1}{\varA}{\varB}$ and $\relEF{\pi_2}{\varA}{\varB}$: for $\enviro \in \Oracle, t \in \PropAnd{\termAE}{\termBE}$, we know that $\pi_1\;t \in \termAE$ and $\pi_2\;t \in \termBE$, which is exactly the expected result.
  \item for any $\varA,\varB,\varC \in \Phi$, for any $t,u \in \Lambda$, if $\relEF t {\varA}{\varB}$ and $\relEF u {\varA}{\varC}$, then $\relEF{\lambda x.\langle t\;x,u\;x\rangle}{\varA}{\PropAnd{\varB}{\varC}}$: let $\enviro\in \Oracle, v \in \termAE$, then $t\;v \in \termBE$ and $u\;v \in \termCE$, so $\langle t\;v,u\;v\rangle \in \PropAnd{\termBE}{\termCE}$ (by the same argument that we used to say that the typing rule $\land_\mathrm i$ is adequate). As $(\lambda x.\langle t\;x,u\;x\rangle)\;v \redE \langle t\;v,u\;v\rangle$, the result follows by saturation.
  \item for any $\varA,\varB \in \Phi$, for any set $\FamC\in\powerset(\Phi)$ and evidences $t \in \Lambda$, if $\forall \varC \in \FamC, \relEF t{\PropAnd{\varA}{\varB}}{\varC}$ then $\relEF{\witLam t}{\varA}{\PropImpl{\varB}{\FamC}}$: let $\enviro \in \Oracle, u \in \termAE$, let's prove that $\witLam t\;u \in \PropImpl{\varB}{\FamC}$. Let $\varC \in \FamC$, and $\enviroT \in \cyl\enviro$. It suffices to show that for any $v \in \termB\enviroT$, $\witLam t\;u\;v \in \termC\enviroT$, but as $\langle u,v\rangle \in (\PropAnd{\varA}{\varB})_\enviro$ (because $A_\enviro \subseteq A_\enviroT$), we deduce that $t\;\langle u,v\rangle \in \termC\enviroT$. Moreover, $\witLam t\;u\;v \redE^2 t\;\langle u,v\rangle$, hence the result by saturation.
  \item for any $\varA \in \Phi, \FamB \in \powerset(\Phi)$ and $\varB \in \FamB$, $\relEF{\witEval}{\PropAnd{(\PropImpl{\varA}{\FamB})}{\varA}}{\varB}$: let $\enviro \in \Oracle$ and $t \in (\PropAnd{(\PropImpl{\varA}{\FamB})}{\varA})_\enviro$, then $\pi_1\;t \in (\PropImpl{\varA}{\FamB})_\enviro$ and $\pi_2\;t \in \termAE$, so for $\varB \in \FamB$, $\pi_1\;t\;(\pi_2\;t) \in \termBE$, hence the result by saturation as $\witEval\;t \redE \pi_1\;t\;(\pi_2\;t)$.
  \end{itemize}
\end{proof}

\begin{remark}
  For any $\enviro \in \Oracle$, it is possible to construct the evidenced frame given by
  \[E \defeq \Lambda \qquad \Phi \defeq \prod_{\enviroT \in \cyl{\enviro}} \SATP\enviroT\]
  with the same functiond and evidenced.
\end{remark}

It is also possible to construct, for any $\enviro \in \Oracle$, the evidenced frame given by $\Phi \defeq \SATE$. There is, in this case, morphisms of evidenced frame.

\begin{definition}[Morphism of evidenced frame]
  Given two evidenced frames $(E_1,\Phi_1)$ and $(E_2,\Phi_2)$, a morphism is a function $F : \Phi_1 \to \Phi_2$ such that:
  \begin{itemize}
  \item $\forall \witx \in E_1, \exists \wity \in E_2, \forall \varphi,\psi \in \Phi_1, \relEF{\witx}\varphi\psi \implies \relEF{\wity}{F(\varphi)}{F(\psi)}$
  \item $\exists \witx \in E_2, \relEF{\witx}{\PropTop_2}{F(\PropTop_1)}$
  \item $\exists \witx \in E_2, \forall \varphi, \psi \in \Phi_1, \relEF{\witx}{\PropAnd{F(\varphi)}{F(\psi)}}{F(\PropAnd{\varphi}{\psi})}$
  \item $\exists \witx \in E_2, \forall \varphi \in \Phi_1, \forall \vec\psi \in \powerset(\Phi_1), \relEF{\witx}{\PropImpl{\varphi}{\{F(\psi)\mid \psi \in \vec\psi\}}}{F(\PropImpl{\varphi}{\vec\psi})}$
  \item $\exists f : \Phi_2 \to \Phi_1, \begin{cases}
      \exists \witx\in E_2, \forall \varphi \in \Phi_2,\relEF{\witx}{\varphi}{F(f(\varphi))}\\
      \exists \witx \in E_2, \forall \varphi \in \Phi_2, \relEF{\witx}{F(f(\varphi))}{\varphi}
    \end{cases}$
  \end{itemize}
\end{definition}

\begin{proposition}
  For any $\enviro \in \Oracle$, the function
  \[\begin{array}{ccc}
  \displaystyle \prod_{\enviro\in\Oracle} \SATE& \longrightarrow & \SATE \\
  \varA_{\enviro\in\Oracle} &\longmapsto & \termAE
  \end{array}\]
  extends to a morphism of evidenced frame.
\end{proposition}

\begin{proof}
  We check each proposition:
  \begin{itemize}
  \item given a term $t \in \Lambda$, the term $t$ is such that for all $\varA,\varB$:
    \[(\forall \enviro \in \Oracle, \forall u \in \termAE, tu \in \termBE) \implies \forall u \in \termAE, tu \in \termBE\]
  \item any term $t$ is an evidence of $\PropTop_2 \leq F(\PropTop_1)$, so we can take for example $\lambda x.x$
  \item for any $\varA,\varB$, we have $(\PropAnd{\varA}{\varB})_\enviro = \PropAnd{\termAE}{\termBE}$, hence the result by taking $\lambda x.x$
  \item we take once again the evidence to be $\lambda x.x$. Let $\varA$ and $\FamB$, then both propositions are equal to
    \[\{t \in \Lambda \mid \forall u \in \termAE, \forall \varB \in \FamB, tu \in \termBE\}\]
  \item let
    \[\begin{array}{ccccc}
    f & : & \SATE & \longrightarrow & \prod_{\enviro\in\Oracle} \SATE\\
    & & A & \longmapsto & \enviroT \mapsto \{t \in \Lambda \mid \exists u \in A, t \redRTP{\enviroT} u\}
    \end{array}\]
    the fact that for each $\enviroT$, the set is $\enviroT$-saturated is a consequence of the definition. In the case of the $\enviro$ component of this set, the set is exactly $A$ as $t \redRTP\enviroT u$ means exactly that $t \in A$ (because $A$ is $\enviro$-saturated). But now, $F(f(\varphi))$ is $A$, so both evidences can be taken to be $\lambda x.x$.
  \end{itemize}

  Thus, the function defines a morphism of evidenced frames.
\end{proof}

\begin{remark}
  The morphism thus defined is stronger in the sense that for $\relEF{\witx}{\varphi}{\psi}$, the associated evidenced $\relEF{\wity}{F(\varphi)}{F(\psi)}$ is $\witx$ itself. This is a kind of logical shift only, where the evidenced are preserved.
\end{remark}
