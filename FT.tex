\subsection{Fan Theorem is realized}

Before proving that $\FT$ is realized, a continuity lemma is needed.

\begin{lemma}[Continuity]\label{lem:continuity}
  Let $\enviro\in\Oracle$ be a reduction context and $t \in \Lambda$ be a term such that
  \[t \realP{\enviro}{} (\Nat \to \Nat) \to \Nat\]
  Then for any $\alpha \realP{\enviro}{} \Nat \to \Nat$, there exists $n\in \bN$ such that
  \[\forall (\beta \realP{\enviro}{} \Nat \to \Nat), (\forall i < n, \beta\;\overline i \eqredE \alpha\;\overline i) \implies t\;\beta \eqredE t\;\alpha\]
\end{lemma}

\begin{proof}
  A FAIRE
\end{proof}

Using this lemma and the $\lambda$-terms from the previous subsection, we can now realize $\FT$.

\begin{theorem}[Realization of Fan Theorem]
  There exists a term
  \[t \realU \FT\]
\end{theorem}

\begin{proof}
  First, let's give the realizer:
  \[t \defeq \lambda b. n_{C(b)}\]
  Let's prove that $t \realU\FT$. Let $\enviro\in\Oracle$ be a reduction context of length $m$ and
  \[b \realP{\enviro}{} \forall \alpha^{\{\Nat \to \Bool\}}, \exists n^{\{\Nat\}}, \restr \alpha n \in B\]
  for some function $B : \List(\bB) \to \SATE$ closed by extension. It suffices to show that
  \[t\;b \realP{\enviro}{} \exists n^{\{\Nat\}}, \forall \alpha^{\{\Nat \to \Bool\}}, \restr\alpha n \in B\]
  but we already know that $n_{C(b)}$ either reduces to an integer or diverges. If it reduces to an integer, then this integer is a uniform bound for $C$, but as $C \subseteq B$, it follows that $n_{C(b)}$ is a uniform bound for $B$.

  Now, suppose $n_{C(b)}$ diverges. This means that for any $n \in \bN$, there exists some word $w_n \in \bB^\star$ such that $w_n \notin C$. By applying Weak KÃ¶nig's Lemma (in our meta-theory), we find an infinite path
  \[\alpha : \bN \to \bB\]
  such that for all $n \in \bN, \restr \alpha n \notin C$. We now enrich our reduction context with this alpha:
  \[\enviroT \defeq \enviro \smallfrown \alpha\]
  so that $\xi_m \realP{\enviroT}{} \Nat \to \Bool$. By definition of $b$, we know that
  \[b\;\xi_m\realP{\enviroT}{} \exists n^{\{\Nat\}}, \restr \alpha n \in B\]
  which we can destruct as some $n \in \bN$ such that
  \[\pi_1\;(b\;\xi_m) \redRTP{\enviroT} n \qquad \pi_2\;(b\;\xi_m)\realP{\enviroT}{} \restr \alpha n \in B\]
  Using lemma \ref{lem:continuity}, we can find an index $p\in \bN$ such that
  \[\forall (\beta \realP{\enviroT}{} \Nat \to \Bool), (\forall i < p, \beta\;\overline i \redRTP{\enviroT} \overline{\alpha(i)}) \implies \pi_1\;(b\;\beta) \redRTP{\enviroT} n\]

  Let
  \[M \defeq \max(n,p)\]
  by continuity, we know that $\pi_1\;(b\;\alpha_M) \redRTP{\enviroT}{} n$, so when computing $C(b)\;\alpha_M$, there exists a list $\ell$ of length $\leq M$ such that $\restr\alpha{{\pi_1\;(b\;\ell 0^\infty)}}$ is a prefix of $\restr{\alpha}{M}$, so $\restr{\alpha}{M} \in C$. But by hypothesis, $\restr{\alpha}{M} \notin C$; hence a contradiction.

  This means that there is no case when $n_{C(b)}$ diverges, so
  \[n_{C(b)}\realP{\enviro}{} \exists n^{\{\Nat\}}, \forall \alpha^{\{\Nat \to \Bool\}}, \restr\alpha n \in B\]
  which means that $t\realU \FT$.
\end{proof}
